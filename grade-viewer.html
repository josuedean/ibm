<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Grade Viewer</title>
<style>
body{font-family:system-ui,sans-serif;margin:2rem;max-width:38rem}
h2{margin-top:2rem}
.error{color:#d00}
ul{list-style:none;padding:0}
li{margin:.25rem 0}
label{display:block;margin:.5rem 0 .25rem}
input,select,button{padding:.35rem .5rem;font-size:1rem}
</style>
</head>
<body>

<!-- ─────────────── LOGIN FORM ─────────────── -->
<section id="login">
  <h1>Grade Viewer</h1>
  <form id="frm">
    <label>Class
      <select id="cls" required>
        <option value="" disabled selected>Choose…</option>
        <option>Digital Literacy</option>
        <option>Global Logistics</option>
      </select>
    </label>

    <label>Student&nbsp;ID <input id="sid" required></label>
    <label>Password&nbsp;&nbsp;&nbsp; <input id="pw" type="password" required></label>

    <button type="submit">View Grades</button>
  </form>
  <p id="err" class="error"></p>
</section>

<!-- ─────────────── GRADE DISPLAY ─────────────── -->
<section id="grades" style="display:none;"></section>

<script>
/* ---------- CONFIG ---------- */
const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzn3fcAIG60ooXdPQ5swvTnmIRbi68gVoje6fUtyeClJTTKKYzug5ujHqUunrRJezqA-w/exec';

/* ---------- UI logic ---------- */
const $ = id => document.getElementById(id);

$('frm').addEventListener('submit', async e=>{
  e.preventDefault();
  $('err').textContent = 'Checking…';

  /* build query-string */
  const qs = new URLSearchParams({
    class: $('cls').value,
    id:    $('sid').value.trim(),
    pw:    $('pw').value,
    tab:   'Totals'
  });

  try {
    const res = await fetch(`${GAS_ENDPOINT}?${qs}`);
    const json = await res.json();
    if (json.status !== 'ok') throw new Error(json.message);
    render(json.data);
  } catch (err){
    $('err').textContent = err.message || err;
  }
});

/* ---------- render grades ---------- */
function render(d){
  $('login').style.display = 'none';
  $('grades').style.display = 'block';

  const g = $('grades');
  g.innerHTML = `
    <h2>Hello, ${d.name}</h2>
    <p><b>Current Points:</b> ${d.currentAvailablePoints.student}/${d.currentAvailablePoints.max}</p>
    <p><b>Current %:</b> ${(+d.currentPercent).toFixed(1)}%</p>
    <p><b>Max Possible Points:</b> ${d.maxPossiblePoints}</p><hr>`;

  for(const [cat, items] of Object.entries(d.categories)){
    g.insertAdjacentHTML('beforeend', `<h3>${cat}</h3><ul id="list-${cat}"></ul>`);
    const ul = document.getElementById(`list-${cat}`);
    items.forEach(it=>{
      ul.insertAdjacentHTML('beforeend',
        `<li>${it.label}: <strong>${it.score ?? 0}/${it.total ?? 0}</strong></li>`);
    });
  }
}
</script>
</body>
</html>
