<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Grade Checker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root { --brand:#0066cc; --bg:#f7f9fc; --border:#dde; }
    body      { font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:var(--bg); margin:2rem; color:#222;}
    h1,h2,h3  { margin:0 0 .6rem }
    .wrap     { max-width:640px; margin:auto; }
    label     { display:block; margin-top:1rem; font-weight:600; }
    input,select,button { width:100%; padding:.65rem; font-size:1rem; }
    button    { background:var(--brand); color:#fff; border:0; border-radius:4px; cursor:pointer; margin-top:1.2rem;}
    button:disabled{opacity:.6;cursor:not-allowed}
    .error    { color:#c00; margin-top:1rem; }
    table     { width:100%; border-collapse:collapse; margin-top:1rem; }
    th,td     { padding:.5rem; border:1px solid var(--border); text-align:left; }
    th        { background:#eef; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Student Grade Lookup</h1>

    <form id="gradeForm">
      <label for="cls">Class</label>
      <select id="cls" required>
        <option value="">— choose a class —</option>
        <option value="digital">Digital Literacy</option>
        <option value="logistics">Logistics</option>
      </select>

      <label for="sid">Student ID</label>
      <input id="sid" required>

      <label for="pw">Password</label>
      <input id="pw" type="password" required>

      <button id="btn">Check grade</button>
    </form>

    <div id="result"></div>
  </div>

<script>
/*  Map class-key ➜ deployed Apps Script URL  */
const ENDPOINT = {
  digital  : 'https://script.google.com/macros/s/AKfycbzl86uXEDhWHhbzh9Gx6He2JZambvFlfIufuZhkgvSqkAcZ4G3ZOejzsVXtGTy_-vw/exec',
  logistics: 'https://script.google.com/macros/s/AKfycbxiarfhH8OmasDgfJKc--634sYSvwMMRZ-kEPbiAVeamjQ12hZaEUkdnPNyqwBnfKSnzA/exec'
};

const form   = document.getElementById('gradeForm');
const resBox = document.getElementById('result');
const btn    = document.getElementById('btn');

form.addEventListener('submit', async evt => {
  evt.preventDefault();
  resBox.innerHTML = '';
  const cls = document.getElementById('cls').value;
  const id  = document.getElementById('sid').value.trim();
  const pw  = document.getElementById('pw' ).value.trim();

  if (!cls || !ENDPOINT[cls]) {
    resBox.innerHTML = '<p class="error">Please select a valid class.</p>';
    return;
  }

  btn.disabled = true;
  try {
    const url   = `${ENDPOINT[cls]}?id=${encodeURIComponent(id)}&password=${encodeURIComponent(pw)}`;
    const resp  = await fetch(url);
    const data  = await resp.json();

    if (data.status !== 'ok') {
      resBox.innerHTML = `<p class="error">${data.message}</p>`;
    } else {
      render(data);
    }
  } catch(e) {
    resBox.innerHTML = '<p class="error">Could not reach the grade server. Try again later.</p>';
    console.error(e);
  } finally {
    btn.disabled = false;
  }
});

function render(d){
  let html = `
    <h2>Hi ${d.name}</h2>
    <p><strong>Overall:</strong> ${d.availablePointsFraction}  (${d.percent} %)</p>
    <h3>Breakdown</h3>
    <table><thead><tr><th>Category</th><th>Points</th></tr></thead><tbody>`;
  for (const [k,v] of Object.entries(d.breakdown)){
    html += `<tr><td>${k}</td><td>${v}</td></tr>`;
  }
  html += '</tbody></table>';
  resBox.innerHTML = html;
}
</script>
</body>
</html>
